/**
 * Global Styles with Accessibility Support
 */

/* NO desktop-specific overrides - desktop should match web exactly */

/* Ketcher Canvas: Proper sizing to fit under header */
.Ketcher-root {
  height: 100% !important;
  max-height: calc(100vh - 56px) !important; /* Account for 56px header */
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
}

/* Canvas area takes available space */
.Ketcher-root .canvas-container,
.Ketcher-root [class*="editor"] {
  flex: 1 1 auto !important;
  min-height: 0 !important;
  overflow: auto !important;
}

/* Bottom toolbar stays at natural position */
.Ketcher-root [class*="bottom"],
.Ketcher-root [class*="Bottom"] {
  flex: 0 0 auto !important;
}

/* NMRium: Let it use its natural layout */
.nmrium-container {
  position: relative !important;
  z-index: 2 !important; /* ensure NMR UI sits above any stray overlays */
  pointer-events: auto !important;
}

/* Ensure NMRium takes full container size */
.nmrium-container > div {
  width: 100% !important;
  height: 100% !important;
}

/* Hide Ketcher information button to avoid overlays affecting NMR */
.Ketcher-root button[title*="Information"],
.Ketcher-root button[title*="information"],
.Ketcher-root button[aria-label*="Information"],
.Ketcher-root button[aria-label*="information"],
/* common alternates seen in Ketcher builds */
.Ketcher-root button[title*="Info"],
.Ketcher-root button[aria-label*="Info"],
.Ketcher-root button[title*="About"],
.Ketcher-root button[aria-label*="About"],
.Ketcher-root button[title="i"],
.Ketcher-root button[aria-label="i"] {
  display: none !important;
}

/* Ensure our app header stays above Ketcher */
.MuiAppBar-root {
  z-index: 9999 !important;
  position: fixed !important;
  pointer-events: auto !important; /* Re-enable pointer events for toolbar interactions */
  height: 56px !important; /* Ensure it doesn't extend beyond its intended height */
}

/* Re-enable pointer events for interactive elements inside the AppBar */
.MuiAppBar-root * {
  pointer-events: auto !important;
}

/* Prevent Ketcher from taking over the top area */
.Ketcher-root {
  margin-top: 56px !important;
  height: calc(100vh - 56px) !important;
}

/* Ensure NMRium can receive keyboard events and clicks */
.nmrium-container,
.nmrium-container * {
  pointer-events: auto !important;
  z-index: 10 !important; /* Above help system */
}

/* Fix main-wrapper blocking clicks - ensure it passes through */
#main-wrapper {
  pointer-events: none !important;
}

/* Hide NMRium logo/info button (i icon) completely */
.nmrium-container button#logo {
  display: none !important;
}

/* Fix tooltip positioning and overlapping issues - make them work properly */
.nmrium-container [role="tooltip"],
.nmrium-container .bp6-tooltip,
.nmrium-container .bp6-popover {
  z-index: 50000 !important; /* Very high z-index to stay on top */
  pointer-events: none !important; /* Prevent tooltip from blocking clicks */
  position: fixed !important;
  max-width: 200px !important;
  word-wrap: break-word !important;
  background: rgba(0, 0, 0, 0.9) !important;
  color: white !important;
  padding: 8px 12px !important;
  border-radius: 6px !important;
  font-size: 12px !important;
  line-height: 1.4 !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* Ensure native browser tooltips work properly */
.nmrium-container [title] {
  position: relative !important;
}

/* Fix Blueprint.js tooltip positioning */
.nmrium-container .bp6-tooltip .bp6-popover-content {
  background: rgba(0, 0, 0, 0.9) !important;
  color: white !important;
  border-radius: 6px !important;
  padding: 8px 12px !important;
  font-size: 12px !important;
  max-width: 200px !important;
  word-wrap: break-word !important;
}


/* Hide tooltips ONLY for the covered logo button */
.nmrium-container button#logo[title] {
  pointer-events: none !important;
}

.nmrium-container button#logo:hover::before,
.nmrium-container button#logo:hover::after {
  display: none !important;
}

/* Fix overlapping dialog/overlay issues */
.nmrium-container .bp6-dialog,
.nmrium-container .bp6-overlay,
.nmrium-container .bp6-popover,
.nmrium-container [role="dialog"],
.nmrium-container [data-testid*="dialog"],
.nmrium-container [class*="dialog"],
.nmrium-container [class*="overlay"] {
  z-index: 1000 !important; /* Lower than our tooltips */
}

/* Fix dialog positioning - let Blueprint handle it naturally */
.nmrium-container .bp6-dialog {
  position: fixed !important;
  /* Remove forced centering - let Blueprint position naturally */
  margin: 0 !important;
}

/* Fix dialog container layout */
.nmrium-container .bp6-dialog .bp6-dialog-container {
  background: rgba(255, 255, 255, 0.95) !important;
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
  border-radius: 8px !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2) !important;
  backdrop-filter: blur(8px) !important;
  /* Ensure proper sizing */
  min-width: 300px !important;
  max-width: 90vw !important;
  max-height: 90vh !important;
  overflow: auto !important;
}

/* Fix popover positioning */
.nmrium-container .bp6-popover {
  position: absolute !important;
  /* Let Blueprint handle positioning */
  transform: none !important;
}

/* Fix popover content layout - but NOT for tooltips */
.nmrium-container .bp6-popover:not(.bp6-tooltip) .bp6-popover-content {
  background: white !important;
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
  border-radius: 6px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  padding: 12px !important;
  min-width: 200px !important;
  max-width: 400px !important;
  max-height: 80vh !important;
  overflow: auto !important;
}

/* Modern UI improvements for NMRium - Safe and targeted */
.nmrium-container {
  /* Modern color palette */
  --modern-bg: #ffffff;
  --modern-surface: #f8f9fa;
  --modern-border: #e9ecef;
  --modern-text: #212529;
  --modern-text-muted: #6c757d;
  --modern-primary: #0d6efd;
  --modern-shadow: 0 2px 4px rgba(0,0,0,0.1);
  --modern-shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
}

/* Modernize buttons with subtle improvements */
.nmrium-container .bp6-button {
  border-radius: 6px !important;
  font-weight: 500 !important;
  transition: all 0.15s ease !important;
  box-shadow: var(--modern-shadow) !important;
}

.nmrium-container .bp6-button:hover {
  transform: translateY(-1px) !important;
  box-shadow: var(--modern-shadow-lg) !important;
}

/* Modernize panels and containers */
.nmrium-container .bp6-panel,
.nmrium-container [class*="panel"] {
  border-radius: 8px !important;
  box-shadow: var(--modern-shadow) !important;
  border: 1px solid var(--modern-border) !important;
}

/* Modernize toolbars */
.nmrium-container .bp6-toolbar,
.nmrium-container [class*="toolbar"] {
  background: var(--modern-surface) !important;
  border-bottom: 1px solid var(--modern-border) !important;
  box-shadow: var(--modern-shadow) !important;
}

/* Modernize dialogs */
.nmrium-container .bp6-dialog .bp6-dialog-container {
  border-radius: 12px !important;
  box-shadow: var(--modern-shadow-lg) !important;
  border: 1px solid var(--modern-border) !important;
  padding: 20px !important;
  max-width: 400px !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
}

/* Ensure dialog content doesn't overflow */
.nmrium-container .bp6-dialog .bp6-dialog-body,
.nmrium-container .bp6-dialog .bp6-dialog-content,
.nmrium-container .bp6-dialog p,
.nmrium-container .bp6-dialog div {
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* Fix toolbar icon overflow */
.nmrium-container .bp6-toolbar,
.nmrium-container [class*="toolbar"],
.nmrium-container [class*="Toolbar"] {
  overflow: visible !important;
  min-width: 48px !important;
  max-width: 60px !important;
}

/* Fix individual toolbar buttons */
.nmrium-container .bp6-toolbar .bp6-button,
.nmrium-container [class*="toolbar"] .bp6-button {
  width: 100% !important;
  min-width: 40px !important;
  max-width: 48px !important;
  height: 40px !important;
  margin: 2px 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* Fix tooltip text overflow - ensure it stays in bubble */
.nmrium-container [role="tooltip"],
.nmrium-container .bp6-tooltip,
.nmrium-container .bp6-popover {
  max-width: 300px !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

/* Ensure tooltip content fits properly */
.nmrium-container .bp6-tooltip .bp6-popover-content,
.nmrium-container .bp6-popover .bp6-popover-content {
  max-width: 280px !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
}

/* Modernize spectrum canvas */
.nmrium-container canvas {
  border-radius: 8px !important;
  box-shadow: var(--modern-shadow) !important;
}

/* Improve typography */
.nmrium-container {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif !important;
  font-feature-settings: 'kern' 1, 'liga' 1 !important;
}

/* Modernize icons */
.nmrium-container .bp6-icon {
  filter: contrast(1.1) !important;
}

/* Subtle animations for better UX */
.nmrium-container * {
  transition: box-shadow 0.15s ease, transform 0.15s ease !important;
}

/* Ensure NMRium gets keyboard focus */
.nmrium-container {
  outline: none !important;
  position: relative !important;
}


/* Focus visible styles for keyboard navigation */
:focus-visible {
  outline: 2px solid #667eea;
  outline-offset: 2px;
}

/* Remove outline for mouse users (keeps it for keyboard) */
:focus:not(:focus-visible) {
  outline: none;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* High contrast mode support */
[data-theme="highContrast"] {
  /* Ensure all text has high contrast */
  --text-color: #ffffff;
  --bg-color: #000000;
  --border-color: #ffffff;
}

[data-theme="highContrast"] * {
  border-width: 2px !important;
}

/* Reduce motion when setting is enabled */
[data-reduce-motion="true"] * {
  animation: none !important;
  transition: none !important;
}

/* Screen reader only text */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Ensure proper focus for interactive elements */
button, a, input, select, textarea {
  &:focus-visible {
    outline: 2px solid #667eea;
    outline-offset: 2px;
  }
}

/* Live region for screen reader announcements */
.live-region {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

/* Ensure search input is always interactive */
.MuiTextField-root,
.MuiTextField-root *,
.MuiOutlinedInput-root,
.MuiInputBase-input,
input[placeholder*="Search compound name"] {
  pointer-events: auto !important;
  z-index: 10000 !important;
}

/* Force search input to be clickable */
.MuiTextField-root input {
  pointer-events: auto !important;
  cursor: text !important;
  z-index: 10001 !important;
}

/* Hide specific NMRium buttons based on SVG paths */
/* Hide question mark help button */
.nmrium-container button[title*="User manual"],
.nmrium-container button[title*="Help"],
.nmrium-container button[title*="help"],
.nmrium-container button[aria-label*="Help"],
.nmrium-container button[aria-label*="help"],
.nmrium-container button[aria-label*="User manual"],
.nmrium-container button svg[viewBox*="504 256"],
.nmrium-container button svg path[d*="504 256c0 136.997"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Hide calendar/table button */
.nmrium-container button[title*="Calendar"],
.nmrium-container button[title*="calendar"],
.nmrium-container button[title*="Table"],
.nmrium-container button[title*="table"],
.nmrium-container button[aria-label*="Calendar"],
.nmrium-container button[aria-label*="calendar"],
.nmrium-container button[aria-label*="Table"],
.nmrium-container button[aria-label*="table"],
.nmrium-container button svg[viewBox*="488 64"],
.nmrium-container button svg path[d*="488 64h-8v20"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Hide info button (i icon) */
.nmrium-container button[title*="Info"],
.nmrium-container button[title*="info"],
.nmrium-container button[title*="Information"],
.nmrium-container button[title*="information"],
.nmrium-container button[aria-label*="Info"],
.nmrium-container button[aria-label*="info"],
.nmrium-container button[aria-label*="Information"],
.nmrium-container button[aria-label*="information"],
.nmrium-container button svg[viewBox*="10 0"],
.nmrium-container button svg path[d*="10 0C4.48 0"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Additional targeting for buttons that might contain these SVG paths */
.nmrium-container button:has(svg path[d*="504 256c0 136.997"]),
.nmrium-container button:has(svg path[d*="488 64h-8v20"]),
.nmrium-container button:has(svg path[d*="10 0C4.48 0"]) {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Hide any toolbar buttons that might contain these icons */
.nmrium-container .bp6-toolbar button:nth-child(3), /* Question mark button */
.nmrium-container .bp6-toolbar button:nth-child(4), /* Calendar/table button */
.nmrium-container .bp6-toolbar button:nth-child(7) { /* Info button */
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Fix settings and menu popup positioning */
.nmrium-container .bp6-menu,
.nmrium-container .bp6-menu-popover,
.nmrium-container [class*="menu"] {
  position: absolute !important;
  z-index: 2000 !important;
  /* Let Blueprint handle positioning naturally */
  transform: none !important;
}

/* Fix settings dialog specific positioning */
.nmrium-container .bp6-dialog[data-testid*="settings"],
.nmrium-container .bp6-dialog[aria-label*="Settings"],
.nmrium-container .bp6-dialog[title*="Settings"] {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  z-index: 2000 !important;
}

/* Fix dropdown menus positioning */
.nmrium-container .bp6-select-popover,
.nmrium-container .bp6-multi-select-popover {
  position: absolute !important;
  z-index: 2000 !important;
  /* Ensure they don't get cut off */
  max-height: 300px !important;
  overflow-y: auto !important;
}

/* Fix tooltip positioning for edge cases */
.nmrium-container .bp6-tooltip-wrapper {
  position: relative !important;
}

/* Ensure tooltips work properly - let Blueprint handle positioning */
.nmrium-container .bp6-tooltip {
  position: fixed !important;
  z-index: 50000 !important;
}

/* Fix any remaining popup positioning issues */
.nmrium-container .bp6-overlay {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  z-index: 1000 !important;
  pointer-events: none !important;
}

.nmrium-container .bp6-overlay .bp6-dialog {
  pointer-events: auto !important;
}

